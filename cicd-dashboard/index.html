<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vframetest Benchmarking Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .stat-value {
            color: #333;
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-change {
            font-size: 0.9em;
            padding: 5px 10px;
            border-radius: 4px;
            display: inline-block;
            background: #e8f5e9;
            color: #2e7d32;
        }

        .stat-change.negative {
            background: #ffebee;
            color: #c62828;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .chart-title {
            color: #333;
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #667eea;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        .builds-table {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }

        .builds-table h3 {
            color: #333;
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #667eea;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: #f5f5f5;
            color: #333;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #ddd;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #eee;
            color: #666;
        }

        tr:hover {
            background: #f9f9f9;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .status-success {
            background: #c8e6c9;
            color: #2e7d32;
        }

        .status-failure {
            background: #ffcccc;
            color: #c62828;
        }

        .platform-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 600;
            margin-right: 5px;
        }

        .platform-macos {
            background: #fff3e0;
            color: #e65100;
        }

        .platform-linux {
            background: #f3e5f5;
            color: #6a1b9a;
        }

        .no-data {
            color: #999;
            text-align: center;
            padding: 40px;
            font-size: 1.1em;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸŽ¯ vframetest Benchmarking Dashboard</h1>
            <p class="subtitle">Automated Performance Metrics & Build Analysis</p>
        </header>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-label">Total Builds</div>
                <div class="stat-value" id="total-builds">0</div>
                <div id="builds-trend"></div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Success Rate</div>
                <div class="stat-value" id="success-rate">0%</div>
                <div id="success-trend"></div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Avg Build Time</div>
                <div class="stat-value" id="avg-build-time">0m</div>
                <div id="time-trend"></div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Latest Version</div>
                <div class="stat-value" id="latest-version">v25.11.21</div>
                <div style="color: #999; font-size: 0.9em;">Current Release</div>
            </div>
        </div>

        <div class="charts-grid">
            <div class="chart-card">
                <div class="chart-title">Build Performance Over Time</div>
                <div class="chart-container">
                    <canvas id="performanceChart"></canvas>
                </div>
            </div>

            <div class="chart-card">
                <div class="chart-title">Platform Comparison</div>
                <div class="chart-container">
                    <canvas id="platformChart"></canvas>
                </div>
            </div>

            <div class="chart-card">
                <div class="chart-title">Build Status Distribution</div>
                <div class="chart-container">
                    <canvas id="statusChart"></canvas>
                </div>
            </div>

            <div class="chart-card">
                <div class="chart-title">Build Time Trend</div>
                <div class="chart-container">
                    <canvas id="timeChart"></canvas>
                </div>
            </div>
        </div>

        <div class="builds-table">
            <h3>Recent Builds</h3>
            <table id="builds-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Version</th>
                        <th>Platform</th>
                        <th>Status</th>
                        <th>Duration</th>
                        <th>Commit</th>
                    </tr>
                </thead>
                <tbody id="builds-tbody">
                    <tr>
                        <td colspan="6" class="no-data">Loading build data...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Sample data generator
        function generateSampleData() {
            const data = [];
            const platforms = ['macOS', 'Linux'];
            const statuses = ['success', 'failure'];
            const baseDate = new Date('2025-11-21');

            for (let i = 0; i < 20; i++) {
                const date = new Date(baseDate);
                date.setHours(date.getHours() - i * 2);

                data.push({
                    date: date.toISOString(),
                    version: 'v25.11.21',
                    platform: platforms[Math.floor(Math.random() * platforms.length)],
                    status: Math.random() > 0.1 ? 'success' : 'failure',
                    duration: Math.floor(Math.random() * 300) + 120, // 2-7 minutes
                    commit: 'abc' + Math.random().toString(36).substr(2, 7)
                });
            }
            return data;
        }

        // Load data from JSON or use sample
        let buildData = [];

        async function loadData() {
            try {
                const response = await fetch('data/builds.json');
                if (response.ok) {
                    buildData = await response.json();
                } else {
                    buildData = generateSampleData();
                }
            } catch (e) {
                console.log('Using sample data:', e);
                buildData = generateSampleData();
            }
            updateDashboard();
        }

        function updateDashboard() {
            updateStats();
            updateCharts();
            updateTable();
        }

        function updateStats() {
            const total = buildData.length;
            const successful = buildData.filter(b => b.status === 'success').length;
            const successRate = total > 0 ? Math.round((successful / total) * 100) : 0;
            const avgTime = total > 0 ? Math.round(buildData.reduce((sum, b) => sum + b.duration, 0) / total) : 0;

            document.getElementById('total-builds').textContent = total;
            document.getElementById('success-rate').textContent = successRate + '%';
            document.getElementById('avg-build-time').textContent = Math.floor(avgTime / 60) + 'm ' + (avgTime % 60) + 's';

            // Trends
            if (total > 1) {
                const recentSuccess = buildData.slice(0, 5).filter(b => b.status === 'success').length;
                const recentRate = Math.round((recentSuccess / 5) * 100);
                const trend = recentRate >= successRate ? 'â†‘' : 'â†“';
                document.getElementById('success-trend').innerHTML = `<span class="${recentRate >= successRate ? '' : 'negative'}">${trend} ${Math.abs(recentRate - successRate)}% from avg</span>`;
            }
        }

        function updateCharts() {
            // Performance chart
            const sortedData = [...buildData].sort((a, b) => new Date(a.date) - new Date(b.date));
            const performanceCtx = document.getElementById('performanceChart').getContext('2d');

            new Chart(performanceCtx, {
                type: 'line',
                data: {
                    labels: sortedData.map(b => new Date(b.date).toLocaleDateString()),
                    datasets: [{
                        label: 'Build Duration (seconds)',
                        data: sortedData.map(b => b.duration),
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Platform comparison
            const macosBuilds = buildData.filter(b => b.platform === 'macOS').length;
            const linuxBuilds = buildData.filter(b => b.platform === 'Linux').length;

            const platformCtx = document.getElementById('platformChart').getContext('2d');
            new Chart(platformCtx, {
                type: 'doughnut',
                data: {
                    labels: ['macOS', 'Linux'],
                    datasets: [{
                        data: [macosBuilds, linuxBuilds],
                        backgroundColor: ['#FFB81C', '#FCC624']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Status chart
            const successful = buildData.filter(b => b.status === 'success').length;
            const failed = buildData.filter(b => b.status === 'failure').length;

            const statusCtx = document.getElementById('statusChart').getContext('2d');
            new Chart(statusCtx, {
                type: 'pie',
                data: {
                    labels: ['Successful', 'Failed'],
                    datasets: [{
                        data: [successful, failed],
                        backgroundColor: ['#4caf50', '#f44336']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Time trend
            const timeCtx = document.getElementById('timeChart').getContext('2d');
            new Chart(timeCtx, {
                type: 'bar',
                data: {
                    labels: sortedData.slice(0, 10).map(b => new Date(b.date).toLocaleDateString()),
                    datasets: [{
                        label: 'Build Duration (seconds)',
                        data: sortedData.slice(0, 10).map(b => b.duration),
                        backgroundColor: '#667eea'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        }

        function updateTable() {
            const tbody = document.getElementById('builds-tbody');
            tbody.innerHTML = '';

            if (buildData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="no-data">No build data available</td></tr>';
                return;
            }

            buildData.slice(0, 20).forEach(build => {
                const date = new Date(build.date);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${date.toLocaleString()}</td>
                    <td><strong>${build.version}</strong></td>
                    <td><span class="platform-badge platform-${build.platform.toLowerCase()}">${build.platform}</span></td>
                    <td><span class="status-badge status-${build.status}">${build.status.toUpperCase()}</span></td>
                    <td>${Math.floor(build.duration / 60)}m ${build.duration % 60}s</td>
                    <td><code>${build.commit}</code></td>
                `;
                tbody.appendChild(row);
            });
        }

        // Load data when page loads
        document.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>
